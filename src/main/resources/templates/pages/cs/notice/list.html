 <title>공지사항 목록</title>
    <link rel="stylesheet" th:href="@{/css/cs/cs_notice.css}" />
    <link rel="stylesheet" th:href="@{/css/basic.css}" />
    <link th:href="@{/css/cs/cs_common.css}" rel="stylesheet" />

<header th:replace="layout/main/header.html"></header>

<main style="margin: 0 auto; margin-bottom: 50px; margin-top: 230px;">
    <aside class="cs_aside">
        <h3 class="aside_title">공지사항</h3>
        <ul class="aside_cate">
            <li class="cate_list"><a th:href="@{/cs/notices}">전체</a></li>
            <li class="cate_list"><a href="#">고객서비스</a></li>
            <li class="cate_list"><a href="#">안전거래</a></li>
            <li class="cate_list"><a href="#">위해상품</a></li>
            <li class="cate_list"><a href="#">이벤트당첨</a></li>
        </ul>
    </aside>

    <div id="main" style="height: auto">
        <nav class="cs_nav">
            <p class="cs_nav_tit"><span>홈</span> > <span>공지사항</span></p>
        </nav>

        <div class="box">
            <section class="cs_notice">
                <div class="cate_bar">
                    <h3 class="cate_title">전체</h3>
                    <p class="cate_des">공지사항 전체 내용입니다.</p>
                </div>
                <ul class="notice_box">
                    <li th:each="notice : ${notices.content}" class="notice">
                        <a th:href="@{|/cs/notice/view/${notice.id}|}">
                            <p class="cate" th:text="${notice.category1Name}">공지 카테고리</p>
                            <p class="content" th:text="${notice.noticeTitle}">공지사항 제목</p>
                            <span class="date" th:text="${#dates.format(notice.noticeRdate, 'yy.MM.dd')}">등록일</span>
                        </a>
                    </li>
                </ul>

                <div class="paging">
                    <a th:href="@{/cs/notices(page=${notices.number - 1})}" th:if="${notices.hasPrevious()}" class="ico btn_prev">이전</a>
                    <span th:each="i : ${#numbers.sequence(0, notices.totalPages - 1)}">
                        <a th:href="@{/cs/notices(page=${i})}" th:text="${i + 1}" th:classappend="${notices.number == i} ? 'active' : ''"></a>
                    </span>
                    <a th:href="@{/cs/notices(page=${notices.number + 1})}" th:if="${notices.hasNext()}" class="ico btn_next">다음</a>
                </div>
            </section>
        </div>
    </div>
</main>
 <script>
     document.addEventListener("DOMContentLoaded", function() {
         const noticeBox = document.querySelector(".notice_box");

         function fetchNotices() {
             fetch("/api/cs/notices/json")
                 .then(response => response.json())
                 .then(data => {
                     noticeBox.innerHTML = ''; // 기존 공지사항 삭제
                     data.content.forEach(notice => {
                         const noticeItem = document.createElement("li");
                         noticeItem.className = "notice";
                         noticeItem.innerHTML = `
                            <a href="/cs/notice/view/${notice.id}">
                                <p class="cate">${notice.category1Name}</p>
                                <p class="content">${notice.noticeTitle}</p>
                                <span class="date">${new Date(notice.noticeRdate).toLocaleDateString()}</span>
                            </a>`;
                         noticeBox.appendChild(noticeItem);
                     });
                 })
                 .catch(error => console.error('Error fetching notices:', error));
         }

         // 페이지 로드 시 처음 한 번 호출
         fetchNotices();

         // 1분마다 공지사항을 새로고침
         setInterval(fetchNotices, 60000); // 60000ms = 1분
     });
 </script>

<footer th:replace="layout/main/footer.html"></footer>